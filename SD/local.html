<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Control v-plotter SDs</title>
        <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>             
    </head>
    <body>              

<!--
<video id="video" playsinline autoplay style="display: none"></video>
<canvas id="canvas_v" width="200" height="200" ></canvas>            
    -->

<!------------------------------------------------------------------------------------------->         
<table border="0" width="100%" height="100%">
    <tr>
        <td align="center" width="12%" valign="top">
            <div style="text-align: left; font-size: 10px" id="version">version: h01</div> <br/>       
            
            <div class="container">
                <div class="tabs">
                    <div class="tab active" data-tab="input">Entrada</div>
                    <div class="tab" data-tab="config">Configuracion</div>
                </div>        
                <div class="content">
                    <div class="tab-content active" id="input">    
                        <fieldset>
                            <legend>Interface</legend>
                            Mostrar mapa tension:<input type="checkbox" id="mostrar_mapa_tension"  onchange="guardar_parametros()"/>    
                            <button type="button" onclick="config_default()">Recargar Config default</button><br/>        
                            <button type="button" onclick="resetZoom()">Reset zoom</button><br/>   
                        </fieldset>                                                                
                        <fieldset>
                            <legend>Pen</legend>
                            <table>                    
                                <tr><td align="right">X:</td><td><input id="pen_x" size="4" value="441" onchange="guardar_parametros()"/></td><td id="pen_motorA"></td></tr>                
                                <tr><td align="right">Y:</td><td><input id="pen_y" size="4" value="200" onchange="guardar_parametros()"/></td><td id="pen_motorB"></td></tr>                   
                                <tr><td align="right">Up pos:</td><td><input id="upPosition" size="4" value="123" onchange="guardar_parametros()"/></td><td rowspan="2">
                                    <button id="cambiar_status_pen" type="button" onclick="cambiar_status_pen()" title="Click para cambiar el estado" >Down</button></td></tr>
                                <tr><td align="right">Down pos:</td><td><input id="downPosition" size="4" value="90" onchange="guardar_parametros()"/></td></tr>       
                                <tr><td align="right">Width:</td><td><input id="penWidth" size="4" value="0.5" onchange="guardar_parametros()"/></td></tr>                                                       
                            </table>
                            <button type="button" onclick="return_to_home()">Return to Home</button><br/>                              
                            <button type="button" onclick="encolar_tarea('getPosition',update_pen_position)">Posicion actual</button><br/>
                            Encolar movimientos:<input type="checkbox" id="mover_gondola" onchange="guardar_parametros()" title="Encola movimiento cuando se hace doble click en una posicion"/>
                            <hr/>
                            <button type="button" onclick="encolar_tarea('initialCalibrate')" title="Ponga la gondola en Home manualmente antes del calibrado inicial" >Calibrado inicial</button><br/>
                            <button type="button" onclick="encolar_tarea('calibrate')" title="Busca los marcadores de posicion y vuelve la gondola a su Home" >Recalibrar</button>
                        </fieldset>  
                        <fieldset>
                            <legend>Imagen</legend>         
                            <input type="file" id="imageLoader" accept="image/*"/>
                             <div class="slider-container">
                                <label for="thresholdSlider">Umbral de detecci√≥n: <span id="thresholdValue">50</span></label><br>
                                <input type="range" id="thresholdSlider" min="10" max="500" value="50">
                            </div>       
                            
                             <div class="slider-container">
                                <label for="escala">Escala: <span id="escala_value">1</span></label><br>
                                <input type="range" id="escala" min="0.1" max="5"  step="0.1" value="1">
                            </div>              
                            
                             <div class="slider-container">
                                <label for="lines_slider">Grosor lineas: <span id="lines_value">2</span></label><br>
                                <input type="range" id="lines_slider" min="1" max="6"  step="1" value="2">
                            </div>
                            
                            <button id="toggleImageBtn">Ocultar Imagen Original</button>
                        </fieldset>         
                      
                    </div>            

                    <div class="tab-content" id="config">                                    
                        <fieldset>
                            <legend>Maquina</legend>
                            <table>
                                <tr><td align="right">Ancho:</td><td><input id="machineSizeMm_x" size="4" value="882" onchange="guardar_parametros()"/></td></tr>
                                <tr><td align="right">Alto:</td><td><input id="machineSizeMm_y" size="4" value="1100" onchange="guardar_parametros()"/></td></tr>
                                <tr><td align="right">Mult. Pasos:</td><td><input id="stepMultiplier" size="4" value="8" onchange="guardar_parametros()"/></td></tr>
                                <tr><td align="right">MM por rev.:</td><td><input id="mmPerRev" size="4" value="126" onchange="guardar_parametros()"/></td></tr>
                                <tr><td align="right">Pasos x Rev.:</td><td><input id="stepsPerRev" size="4" value="4076" onchange="guardar_parametros()"/></td></tr>
                                <tr><td align="right">Vel. maxima:</td><td><input id="currentMaxSpeed" size="4" value="1000" onchange="guardar_parametros()"/></td></tr>
                                <tr><td align="right">Aceleracion:</td><td><input id="currentAcceleration" size="4" value="400" onchange="guardar_parametros()"/></td></tr>
                            </table>
                            <button type="button" onclick="encolar_tarea('getMachineSpecs',update_machine_specs)">Cargar conf de la maquina</button><br/>
                            <button type="button" onclick="send_machine_specs()">Enviar conf a la maquina</button><br/>
                            <button type="button" onclick="encolar_tarea('releaseMotors')">Desenergizar motores</button> <br/>     
                            <button type="button" onclick="encolar_tarea('restart')">Restart ESP32</button> <br/>
                        </fieldset>
                        <fieldset>
                            <legend>Pagina</legend>
                            <table>
                                <tr><td align="right">Ancho:</td><td><input id="page_width" size="4" value="210" onchange="guardar_parametros()"/></td><td></td></tr>
                                <tr><td align="right">Alto:</td><td><input id="page_height" size="4" value="297" onchange="guardar_parametros()"/></td><td></td></tr>
                                <tr><td align="right">posX:</td><td><input id="page_pos_x" size="4" value="336" onchange="guardar_parametros()"/></td><td><button type="button" onclick="centrar_pagina_x()">Centrar</button> </td></tr>
                                <tr><td align="right">posY:</td><td><input id="page_pos_y" size="4" value="200" onchange="guardar_parametros()"/></td><td></td></tr>
                            </table>
                        </fieldset>
                        <fieldset>
                            <legend>Home</legend>
                            <table>
                                <tr><td>X:<input id="home_pos_x" size="4" value="441" onchange="guardar_parametros()"/></td>
                                    <td rowspan="2"><button type="button" onclick="set_home()">Set Home</button></td></tr>
                                <tr><td>Y:<input id="home_pos_y" size="4" value="200" onchange="guardar_parametros()"/></td></tr>
                            </table>                
                        </fieldset>
                    </div>
                </div>
            </div>
        </td>
        <td align="center"  width="70%" valign="top">
            <div class="canvas-container">
                <canvas id="machine" width="100%" height="100%" title="Haga click para mover o la rueda para hacer zoom, doble click mueve la gondola."></canvas>

                <canvas id="originalCanvas" width="0%" height="0%" ></canvas>
                <canvas id="lineCanvas"  width="0%" height="0%" ></canvas>
            </div>
        </td>
        <td align="center"  valign="top">       
            <table width="100%">
                <tr><td align="left"><div id ="estado_cola" title="Haga click para pausar o activar la cola"></div></td></tr>
                <tr><td align="right">
                         <input type="file" id="fileInput" style="display: none;"/>
                         <input id="comando_gcode" size="19" style="text-align:left;" title="Escriba el comando GCODE y presione enter para encolarlo"/>
                         <button class="btn" onclick="document.getElementById('fileInput').click()">Importar</button>
                         <button type="button" onclick="limpiar_cola()">Limpiar</button>
                    </td>
                </tr>
            </table>
            <textarea readonly id="tareas" name="log" rows="24" cols="50"></textarea>
             <table width="100%">
                <tr><td align="left">Tareas ejecutadas:</td><td align="right"><button type="button" onclick="limpiar_ejecutadas()">Limpiar</button></td></tr>
            </table>
            <textarea readonly id="log" name="log" rows="24" cols="50"></textarea>
        </td>
    </tr>
</table>
<!------------------------------------------------------------------------------------------->
 
             <canvas id="debug"  width="0%" height="0%" ></canvas>
             <canvas id="debug2"  width="0%" height="0%" ></canvas>
             <canvas id="debug3"  width="0%" height="0%" ></canvas>

<link rel="stylesheet" href="styles.css">
<script src="util.js"></script>
<script src="webcam.js"></script>
<script src="capture.js"></script>



        </div>
        <a href="/" target="_self">Cargar controlador desde CDN</a><br /><br />
        <div id="sdcard_present"></div>
    </body>
    <script src="control.js"></script>
    <script>          
        init();
        //mostrarCamara() ;
    </script>
</html>


