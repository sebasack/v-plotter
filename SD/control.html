<script src="https://cdn.jsdelivr.net/gh/sebasack/v-plotter@latest/SD/webcam.js"></script>

<style>
    textarea {
        width: 100%;
        height: 90%;
    }
    body {
        font-family: Courier, monospaced;
        font-size: 13px;
    }  
    input{
        padding:0px;
        font-size:12px;
        line-height:2px;
        text-align:right;
    }
</style>

<video id="video" playsinline autoplay style="display: none"></video>

<table border="0" width="100%" height="100%">
    <tr>
        <td align="center" width="12%" valign="top">
            <div style="text-align: left; font-size: 10px" id="version">version: 0.1</div> <br/>
            
            <fieldset>
                <legend>Maquina</legend>
                <table>
                    <tr><td align="right">Ancho:</td><td><input id="machineSizeMm_x" size="4" value="600" onchange="guardar_parametros()"/></td></tr>
                    <tr><td align="right">Alto:</td><td><input id="machineSizeMm_y" size="4" value="800" onchange="guardar_parametros()"/></td></tr>
                    <tr><td align="right">Mult. Pasos:</td><td><input id="stepMultiplier" size="4" value="8" onchange="guardar_parametros()"/></td></tr>
                    <tr><td align="right">MM por rev.:</td><td><input id="mmPerRev" size="4" value="126" onchange="guardar_parametros()"/></td></tr>
                    <tr><td align="right">Pasos x Rev.:</td><td><input id="stepsPerRev" size="4" value="4076" onchange="guardar_parametros()"/></td></tr>
                </table>
                <button type="button" onclick="ejecutar_comando('getMachineSpecs',update_machine_specs)">Obtener esp. de la maquina</button><br/>
                <button type="button" onclick="ejecutar_comando('releaseMotors')">Desenergizar motores</button> <br/>
                <button type="button" onclick="ejecutar_comando('restart')">Restart ESP32</button> <br/>
            </fieldset>
            <fieldset>
                <legend>Pagina</legend>
                <table>
                    <tr><td align="right">Ancho:</td><td><input id="page_width" size="4" value="210" onchange="guardar_parametros()"/></td><td></td></tr>
                    <tr><td align="right">Alto:</td><td><input id="page_height" size="4" value="297" onchange="guardar_parametros()"/></td><td></td></tr>
                    <tr><td align="right">posX:</td><td><input id="page_pos_x" size="4" value="195" onchange="guardar_parametros()"/></td><td><button type="button" onclick="centrar_pagina_x()">Centrar</button> </td></tr>
                    <tr><td align="right">posY:</td><td><input id="page_pos_y" size="4" value="100" onchange="guardar_parametros()"/></td><td></td></tr>
                </table>
            </fieldset>
            <fieldset>
                <legend>Home</legend>
                X:<input id="home_pos_x" size="4" value="300" onchange="guardar_parametros()"/><br/>
                Y:<input id="home_pos_y" size="4" value="100" onchange="guardar_parametros()"/><br/>
                <button type="button" onclick="ejecutar_comando('setHome')">Set Home</button> <br/>
            </fieldset>
            <fieldset>
                <legend>Pen</legend>
                <table>
                    <tr><td align="right">X:</td><td><input id="pen_x" size="4" value="300" onchange="guardar_parametros()"/></td><td id="pen_motorA"></td></tr>                
                    <tr><td align="right">Y:</td><td><input id="pen_y" size="4" value="100" onchange="guardar_parametros()"/></td><td id="pen_motorB"></td></tr>
                </table>
                <button type="button" onclick="return_to_home()">Return to Home</button> <br/>
                <button type="button" onclick="ejecutar_comando('penLift')">Arriba</button>
                <button type="button" onclick="ejecutar_comando('penDown')">Abajo</button><br/>
                <button type="button" onclick="ejecutar_comando('getPosition',update_pen_position)">Posicion actual</button> <br/>
                Calibrado:<br>
                <button type="button" onclick="ejecutar_comando('initialCalibrate')" title="Ponga la gondola en Home manualmente antes del calibrado inicial" >Calibrado inicial</button><br>
                <button type="button" onclick="ejecutar_comando('calibrate')" title="Busca los marcadores de posicion y vuelve la gondola a su Home" >Recalibrar </button>              
            </fieldset>      
            <fieldset>
                <legend>Interface</legend>     
                Mostrar mapa tension:<input type="checkbox" id="mapa_tension" name="preference"  onchange="guardar_parametros()">          
                <button type="button" onclick="config_default()">Recargar Config default</button><br/>               
            </fieldset>                 
        </td>
        <td align="center" valign="center">
            <canvas id="machine" width="0" height="0"></canvas>
        </td>
        <td align="center"  width="25%" valign="top">
            <fieldset>
                <legend>Comandos GCODE</legend>
                <input id="comando" />
                <button type="button" onclick="ejecutar_comando($('#comando').val())" title="ingrese un comando GCODE">Enviar</button>
            </fieldset>
            <textarea id="log" name="log" rows="20" cols="50"> </textarea><br/>
        </td>
    </tr>
</table>